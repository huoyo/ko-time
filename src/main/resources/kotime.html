<head>
    <meta charset="UTF-8">
    <title>KoTime</title>
    <style>
        UIKitCss
        commonCss
    </style>
    <script>
        UIKitJs;
        uiKitIconsJs;
        MetricFlowJs;
        jQueryJs;
        KoTimeUtil;
        var graph;
        var d = 180;
        var globalThreshold = globalThresholdValue;
        var globalNeedLogin = globalNeedLoginValue;
        var staticTokenVisit = staticTokenVisitValue;
        var staticToken = staticTokenValue;
        var globalToken = staticTokenVisit ? staticToken : sessionStorage.getItem("kotimeToken");
        let globalIsLogin = false;
        let koTimeVersion = koTimeVersionValue;
        let abbreviationEnable = abbreviationEnableValue;

        function concatToken(url) {
            if (globalNeedLogin) {
                if (url.indexOf('?') > -1) {
                    url += '&kotoken=' + globalToken;
                } else {
                    url += '?kotoken=' + globalToken;
                }
            }
            return url
        }

        function refreshData() {
            get(concatToken('contextPath/koTime/isLogin'), function (data) {
                globalIsLogin = data['content']['isLogin'] == 1 ? true : false;
                if (globalNeedLogin == true && globalIsLogin == false) {
                    UIkit.modal(getDom("modal-login")).show();
                    return;
                } else {
                    loadStatistic();
                    loadConfig();
                    addConfigEvent();
                    loadApis();
                    loadExceptions();
                    loadCpuInfo();
                    loadHeapMemoryInfo();
                    loadNonHeapMemoryInfo();
                    loadPhysicalMemoryInfo();
                    loadEdenSpace();
                    loadSurvivorSpace();
                    loadOldGenSpace();
                    loadMetaspace();
                    loadGcUsage();
                    loadThreadUsage();
                    loadClassUsage();
                    loadThreadsInfo();
                    loadDynamicProperties();
                }
            });
        }

        function loadExceptions() {
            get(concatToken('contextPath/koTime/exceptions'), function (res) {
                if (res['state']==0) {
                    noticeError("载入exceptions失败！");
                    return;
                }
                let data = res['content'];
                let element = getDom('exceptionList');
                html = '';
                for (let i = 0; i < data.length; i++) {
                    let id = data[i]['id'];
                    let className = data[i]['className'];
                    let message = data[i]['message'];
                    html += "<li onclick=\"showExceptions('" + id + "','" + message + "')\" style='' id=\"" + id + "\"><span style='font-size: 16px;font-weight: 500;'>" + className + "</span>&nbsp &nbsp<span style='font-size: 10px;' class=\"uk-label uk-label-danger\">" + message + "</span></li>";
                }
                ;
                element.innerHTML = html;
            });
        }

        function loadApis() {
            let searchDom = getDom("searchText");
            let searchText = searchDom.value;
            let apiSortName = getDom('apiSortName')
            let apiSortType = getDom('apiSortType')
            get(concatToken(`contextPath/koTime/interfaces?question=${searchText}&orderBy=${apiSortName.value}&sort=${apiSortType.value}`), function (res) {
                if (res['state']==0) {
                    noticeError("载入interfaces失败！");
                    return;
                }
                let data = res['content'];
                searchDom.value='';
                let element = getDom('apiList');
                html = '';
                for (let i = 0; i < data.length; i++) {
                    let className = data[i]['className'];
                    let methodName = data[i]['methodName'];
                    let avgRunTime = data[i]['avgRunTime'];
                    let methodType = data[i]['methodType'];
                    let routeName = data[i]['routeName'];
                    let callNum = data[i]['callNum'];

                    let apiId = className + "." + methodName;
                    let color = avgRunTime > globalThreshold ? 'danger' : 'success';
                    if (abbreviationEnable) {
                        className = data[i]['name'].split('.')[0];
                    }
                    if (methodType == 'Controller' && routeName != null && routeName != '') {
                        html += "<li onclick=\"showMethods('" + apiId + "')\" class='common-li' id=\"" + apiId + "-list\">" + className + "#<span class='common-li-bolder'>" + methodName + "</span><span style='color: #9c40ad;font-size: 14px;font-weight: bold'>()</span>&nbsp; <span style='color: #d1d1e7'>&lt;</span><span class='common-li-special'>" + routeName + "</span><span style='color: #d1d1e7'>&gt;</span> &nbsp; &nbsp;<span style='font-size: 10px;text-transform: lowercase' class=\"uk-label uk-label-" + color + "\">{{tab.interface.interface-list.avg-tip}} " + avgRunTime + " ms</span>" +
                            "&nbsp &nbsp<span style='font-size: 10px;text-transform: unset;background-color:#6d6d85' class=\"uk-label\">{{tab.interface.interface-list.call-num-tip}} " + callNum + "</span></li>";
                    } else {
                        html += "<li onclick=\"showMethods('" + apiId + "')\" class='common-li' id=\"" + apiId + "-list\">" + className + "#<span class='common-li-bolder'>" + methodName + "</span><span style='color: #9c40ad;font-size: 14px;font-weight: bold'>()</span>&nbsp; &nbsp;<span style='font-size: 10px;text-transform: unset' class=\"uk-label uk-label-" + color + "\">{{tab.interface.interface-list.avg-tip}} " + avgRunTime + " ms</span>" +
                            "&nbsp; &nbsp;<span style='font-size: 10px;text-transform: lowercase;background-color:#6d6d85' class=\"uk-label\">{{tab.interface.interface-list.call-num-tip}} " + callNum + "</span></li>";
                    }
                };
                element.innerHTML = html;
            });
        }

        function loadStatistic() {
            get(concatToken('contextPath/koTime/interfaces/usage'), function (res) {
                if (res['state']==0) {
                    noticeError("载入interfaces/usage失败！");
                    return;
                }
                let data = res['content'];
                let totalNum = data['totalNum'];
                let systemTotalNum = getDom("systemTotalNum");
                systemTotalNum.innerHTML = totalNum;

                let normalNum = data['normalNum'];
                let systemNormalNum = getDom("systemNormalNum");
                systemNormalNum.innerHTML = normalNum;

                let delayNum = data['delayNum'];
                let systemDelayNum = getDom("systemDelayNum");
                systemDelayNum.innerHTML = delayNum;

                let avgRunTime = data['avgRunTime'];
                let systemAvgRunTime = getDom("systemAvgRunTime");
                systemAvgRunTime.innerHTML = avgRunTime;
                if (avgRunTime > globalThreshold) {
                    getDom("systemAvgRunTime").style.color = '#cc0c0c';
                } else {
                    getDom("systemAvgRunTime").style.color = '#29da93';
                }
                ;

                let maxRunTime = data['maxRunTime'];
                let systemMaxRunTime = getDom("systemMaxRunTime");
                systemMaxRunTime.innerHTML = maxRunTime;
                if (maxRunTime > globalThreshold) {
                    getDom("systemMaxRunTime").style.color = '#cc0c0c';
                } else {
                    getDom("systemMaxRunTime").style.color = '#29da93';
                }
                ;


                let minRunTime = data['minRunTime'];
                let systemMinRunTime = getDom("systemMinRunTime");
                systemMinRunTime.innerHTML = minRunTime;
                if (minRunTime > globalThreshold) {
                    getDom("systemMinRunTime").style.color = '#cc0c0c';
                } else {
                    getDom("systemMinRunTime").style.color = '#29da93';
                };

                let avgCallNum = data['avgCallNum'];
                let systemAvgCallNumDom = getDom("systemAvgCallNum");
                systemAvgCallNumDom.innerHTML = avgCallNum;

                let minCallNum = data['minCallNum'];
                let systemMinCallNumDom = getDom("systemMinCallNum");
                systemMinCallNumDom.innerHTML = minCallNum;


                let maxCallNum = data['maxCallNum'];
                let systemMaxCallNumDom = getDom("systemMaxCallNum");
                systemMaxCallNumDom.innerHTML = maxCallNum;

            });
        }

        function addConfigEvent() {
            getDom('kotimeEnable').onclick = function () {
                put(concatToken('contextPath/koTime/configs'),{enable: getDom('kotimeEnable').checked},function (res) {
                    noticeSuccess('{{tab.configuration.kotime-config.change-ok-tip}}');
                },function () {
                    noticeError('{{tab.configuration.kotime-config.change-fail-tip}}');
                })
            };

            getDom('exceptionEnable').onclick = function () {
                put(concatToken('contextPath/koTime/configs'),{exceptionEnable: getDom('exceptionEnable').checked},function (res) {
                    noticeSuccess('{{tab.configuration.kotime-config.change-ok-tip}}')
                },function () {
                    noticeError('{{tab.configuration.kotime-config.change-fail-tip}}')
                })
            };

            getDom('logEnable').onclick = function () {
                put(concatToken('contextPath/koTime/configs'),{logEnable: getDom('logEnable').checked},function (res) {
                    noticeSuccess('{{tab.configuration.kotime-config.change-ok-tip}}')
                },function () {
                    noticeError('{{tab.configuration.kotime-config.change-fail-tip}}')
                })
            };

            getDom('mailEnable').onclick = function () {
                put(concatToken('contextPath/koTime/configs'),{mailEnable: getDom('mailEnable').checked},function (res) {
                    noticeSuccess('{{tab.configuration.kotime-config.change-ok-tip}}')
                },function () {
                    noticeError('{{tab.configuration.kotime-config.change-fail-tip}}')
                })
            };

            getDom('abbreviationEnable').onclick = function () {
                put(concatToken('contextPath/koTime/configs'),{abbreviationEnable: getDom('abbreviationEnable').checked},function (res) {
                    noticeSuccess('{{tab.configuration.kotime-config.change-ok-tip}}')
                },function () {
                    noticeError('{{tab.configuration.kotime-config.change-fail-tip}}')
                })
            };

            getDom('languageSwitch').onclick = function () {
                let selectedObj = getDom('languageSwitch');
                put(concatToken('contextPath/koTime/configs'),{language: selectedObj.options[selectedObj.selectedIndex].value},function (res) {
                    noticeSuccess('{{tab.configuration.kotime-config.change-ok-tip}}')
                },function () {
                    noticeError('{{tab.configuration.kotime-config.change-fail-tip}}')
                })
            };

            getDom('timeThresholdYes').onclick = function () {
                put(concatToken('contextPath/koTime/configs'),{threshold: getDom('timeThreshold').value},function (res) {
                    noticeSuccess('{{tab.configuration.kotime-config.change-ok-tip}}')
                },function () {
                    noticeError('{{tab.configuration.kotime-config.change-fail-tip}}')
                })
            };

            getDom('clearDataYes').onclick = function () {
                post(concatToken('contextPath/koTime/clearData'),{},function (res) {
                    noticeSuccess('{{tab.configuration.kotime-config.change-ok-tip}}')
                },function () {
                    noticeError('{{tab.configuration.kotime-config.change-fail-tip}}')
                })
            };

        }

        function loadConfig() {
            get(concatToken('contextPath/koTime/configs'), function (res) {
                if (res['state']==0) {
                    noticeError("载入configs失败！");
                    return;
                }
                let data = res['content'];
                let versionNoticeEnable = data['versionNotice'];
                if (versionNoticeEnable) {
                    loadLatestVersion();
                }

                let exceptionEnable = data['exceptionEnable'];

                let exceptionEnableDom = getDom('exceptionEnable');
                exceptionEnableDom.checked = exceptionEnable;

                let kotimeEnable = data['enable'];
                let kotimeEnableDom = getDom('kotimeEnable');
                kotimeEnableDom.checked = kotimeEnable;

                let apiTip = getDom('apiTip');
                apiTip.innerHTML = kotimeEnable == true ? "{{tab.summary.bottom-normal-tip}}" :
                    "{{tab.summary.bottom-close-tip}}";


                let threshold = data['threshold'];
                let timeThresholdDom = getDom('timeThreshold');
                timeThresholdDom.value = threshold;

                let logEnable = data['logEnable'];
                let logEnableDom = getDom('logEnable');
                logEnableDom.checked = logEnable;

                let mailEnable = data['mailEnable'];
                let mailEnableDom = getDom('mailEnable');
                mailEnableDom.checked = mailEnable;

                let abbreviationEnable = data['abbreviationEnable'];
                let abbreviationEnableDom = getDom('abbreviationEnable');
                abbreviationEnableDom.checked = abbreviationEnable;

                let language = data['language'];
                $("#languageSwitch").val(language)
            });
        }

        let methodParamMap = new Map();

        function paramGraph(e) {
            let clickNode = e.currentTarget;
            if (clickNode == null) {
                return
            }
            ;
            let clickNodeId = clickNode.id;
            if (methodParamMap.has(clickNodeId + "ana")) {
                graph.removeNode(clickNodeId + "ana")
                methodParamMap.delete(clickNodeId + "ana")
            } else {
                get(concatToken('contextPath/koTime/interfaces/'+clickNodeId.replace('node', '')+'/paramMetric'), function (res) {
                    if (res['state']==0) {
                        noticeError("载入paramMetric失败！");
                        return;
                    }
                    let data = res['content'];
                    let datas = []
                    for (let key in data) {
                        datas.push({"name": key + "：{{tab.interface.interface-list.show-metric.avg}} " + data[key]['avgRunTime'] + " ms"})
                    }
                    ;
                    let paramGraphData = {
                        "id": clickNodeId + "ana",
                        "from": clickNodeId,
                        "title": {'name': "{{tab.interface.interface-list.show-metric.param-analyse}}"},
                        "data": datas,
                        'style': {
                            'title-color': '#427b72',
                            'border-color': '#427b72',
                            'data-font-size': '10px',
                            'title-font-size': '12px'
                        }
                    }
                    let clickNodeX = Number(clickNode.getAttribute("x"));
                    let clickNodeY = Number(clickNode.getAttribute("y"));
                    graph.createNode(paramGraphData, clickNodeX, clickNodeY - 100);
                    // graph.createNode(paramGraphData,e.x+150,e.y-30);
                    methodParamMap.set(clickNodeId + "ana", "")
                });
            }
        }

        function formData(data) {
            if (data['avgRunTime'] > globalThreshold) {
                data['style'] = {
                    'title-color': '#c71335',
                    'border-color': '#c71335',
                    'data-font-size': '10px',
                    'title-font-size': '12px'
                }
            } else {
                data['style'] = {
                    'title-color': '#375d46',
                    'border-color': '#375d46',
                    'data-font-size': '10px',
                    'title-font-size': '12px'
                }
            }
            ;
            data['title'] = {'name': data['name']};
            data['data'] = [
                {'name': '<span style="color:gray">{{tab.interface.interface-list.show-metric.type}}：</span>' + data['methodType']},
                {'name': '<span style="color:gray">{{tab.interface.interface-list.show-metric.avg}}：</span>' + data['avgRunTime'] + ' ms'},
                {'name': '<span style="color:gray">{{tab.interface.interface-list.show-metric.max}}：</span>' + data['maxRunTime'] + ' ms'},
                {'name': '<span style="color:gray">{{tab.interface.interface-list.show-metric.min}}：</span>' + data['minRunTime'] + ' ms'}
            ];
            if (data['exceptionNum'] != null && data['exceptionNum'] > 0) {
                data['data'].push({'name': '<span style="color:gray">{{tab.interface.interface-list.show-metric.exception-num}}：</span>' + data['exceptionNum'] +
                        ' {{tab.interface.interface-list.show-metric.exception-unit}}'});
            }
            data["dblclick"] = "paramGraph";
            return data;
        };


        function showMethods(methodId) {
            let exceptionDetailDom = getDom('layerDemo');
            exceptionDetailDom.innerHTML = "";
            let options = {
                'link-start-offsetx': 8,
                'link-start-offsety': 0,
                'link-end-offsetx': +10,
                'link-end-offsety': 0,
                'link-width-offset': 0
            };
            graph = new MetricFlow("layerDemo", options);
            graph.threshold = globalThreshold;
            UIkit.notification.closeAll();
            UIkit.modal(getDom("modal-method")).show();

            get(concatToken('contextPath/koTime/interfaces/'+methodId+'/tree'), function (res) {
                if (res['state']==0) {
                    noticeError("载入tree失败！");
                    return;
                }
                let data = res['content'];
                let rootX = 100;
                let rootY = window.innerHeight / 2 - 50;
                data['x'] = rootX;
                data['y'] = rootY;
                graph.createNodes(data, formData);

            });

        };

        function showExceptions(id, message) {
            get(concatToken('contextPath/koTime/exceptions/' + id + '/details?message=' + message), function (res) {
                if (res['state']==0) {
                    noticeError("载入tree失败！");
                    return;
                }
                let data = res['content'];
                let html = '';
                for (let i = 0; i < data.length; i++) {
                    html +=
                        "<ul class=\"uk-list uk-list-divider\">\n" +
                        "\t<li id=\"exception-class\">{{tab.exception.exception-list.show-metric.class}}：" + data[i].occurClassName + "</li>\n" +
                        "\t<li id=\"exception-method\">{{tab.exception.exception-list.show-metric.method}}：" + data[i].methodName + "</li>\n" +
                        "\t<li id=\"exception-line\">{{tab.exception.exception-list.show-metric.line}}：<span class=\"uk-label uk-label-success\">" + data[i].location + "</span></li>\n" +
                        "\t<li id=\"exception-message\">{{tab.exception.exception-list.show-metric.message}}：<span class=\"uk-label uk-label-danger\">" + data[i].message + "</span></li>\n" +
                        "</ul>"
                    if (data.length - 1 > i) {
                        html += '<hr class="uk-divider-icon">'
                    }
                }
                ;

                let exceptionDetailDom = getDom('exception-detail');
                exceptionDetailDom.innerHTML = html;
                UIkit.notification.closeAll();
                UIkit.modal(getDom("modal-exception")).show();
            });
        };

        function login() {
            let userId = $("#userName").val()
            let password = $("#userPassword").val()
            if (userId == undefined || userId.length < 1 || password == undefined || password.length < 1) {
                noticeError('请正确输入用户名和密码')
                return
            }
            post("contextPath/koTime/login",{'userName': userId, 'password': password},function (re) {
                if (re['state'] == 1) {
                    noticeSuccess('登录成功')
                    sessionStorage.setItem("kotimeToken", re['content']["token"]);
                    location.reload();
                } else {
                    noticeError('用户名或密码错误')
                }
            },function (re) {
                console.error(re)
            })
        }

        function searchTip(e) {
            let question = $('#searchText').val()
            get(concatToken('contextPath/koTime/interfaces/searchCondidate?question=' + question), function (res) {
                if (res['state']==0) {
                    noticeError("载入interfaces/searchCondidate失败！");
                    return;
                }
                let data = res['content'];
                $("#condidates").html("")
                for (let i = 0; i < data.length; i++) {
                    let name = data[i];
                    $("#condidates").append('<option value="' + name + '"/>');
                }
                ;
            });
        }

        function searchApis(e) {
            if (e.keyCode == 13) {
                loadApis()
            }
        }

        function updateClass() {
            // document.querySelector("#classForm").submit();
            var formData = new FormData();
            var file = document.querySelector('#classFile').files[0];
            if (file == null || file == undefined) {
                noticeError('{{tab.hotupdate.class-file-null-tip}}')
                return;
            }
            var className = document.querySelector("#className").value
            if (className == null || className == undefined || className.length < 2) {
                noticeError('{{tab.hotupdate.class-name-null-tip}}')
                return;
            }
            formData.append('classFile', file);
            putFormData(concatToken('contextPath/koTime/classes/'+className+'/replace'),formData,function (res) {
                    if (res['state'] == 1) {
                        noticeSuccess('{{tab.hotupdate.change-ok-tip}}')
                    } else {
                        noticeError(res['message'])
                    }
                }, function (XmlHttpRequest, textStatus, errorThrown) {
                    noticeError('{{tab.hotupdate.change-fail-tip}}')
                    location.reload();
                }
            )

        }

        function updateDynamicProperties() {
            let propertiesDom = document.querySelector("#dynamicText");
            let propertiesText = propertiesDom.value;
            if (propertiesText && propertiesText.indexOf("=") > 0) {
                put(concatToken('contextPath/koTime/dynamicProperties'),{text: propertiesText.trim()},function (re) {
                    noticeSuccess('{{tab.configuration.dynamic-config.change-ok-tip}}')
                },function (re) {
                    noticeError('{{tab.configuration.dynamic-config.change-fail-tip}}')
                })
            } else {
                noticeError('{{tab.configuration.dynamic-config.change-fail-tip}}')
            }

        }

        function loadDynamicProperties() {
            get(concatToken('contextPath/koTime/dynamicProperties'), function (res) {
                let text = res['content'];
                document.querySelector("#dynamicText").value = text;
            });
        }


        function loadLatestVersion() {
            get('http://www.kotime.cn/common/latestVersion?version='+koTimeVersion,function (res) {
                if (res['state'] == 1) {
                    document.querySelector("#version-notice").innerHTML = res['content']['versionNo']
                }
            },function (XmlHttpRequest, textStatus, errorThrown) {
            })
        }

        function loadCpuInfo() {
            get(concatToken('contextPath/koTime/cpus/usage'), function (res) {
                if (res['state']==0) {
                    noticeError("载入cpus/usage失败！");
                    return;
                }
                let data = res['content'];
                let systemLoad = data['systemLoad'] * 100;
                let userRate = data['userRate'] * 100;
                let sysRate = data['sysRate'] * 100;
                let logicalNum = data['logicalNum'];
                let waitRate = data['waitRate'] * 100;
                var systemLoadDom = document.querySelector("#systemLoad");
                if (systemLoad > 50) {
                    systemLoadDom.style.color = '#cc0c0c';
                } else {
                    systemLoadDom.style.color = '#29da93';
                }
                ;
                systemLoadDom.innerHTML = `${systemLoad.toFixed(2)}%`;
                document.querySelector("#cpuSysRate").innerHTML = `${sysRate.toFixed(2)}%`;
                document.querySelector("#cpuUserRate").innerHTML = `${userRate.toFixed(2)}%`;
                document.querySelector("#cpuLogicalAmount").innerHTML = `{{tab.summary.sysusage-metric.cpu-usage}}（${logicalNum}）：`;
            });
        }

        function loadHeapMemoryInfo() {
            get(concatToken('contextPath/koTime/memories/heap'), function (res) {
                if (res['state']==0) {
                    noticeError("载入memories/heap失败！");
                    return;
                }
                let data = res['content'];
                // let initValue = data['initValue'] / 1024 / 1024;
                // let maxValue = data['maxValue'] / 1024 / 1024;
                // let usedValue = data['usedValue'] / 1024 / 1024;
                let initValue = getSize(data['initValue']);
                let maxValue = getSize(data['maxValue']);
                let usedValue = getSize(data['usedValue']);
                let usedRate = data['usedRate'] * 100;
                var heapUsedRateDom = document.querySelector("#heapUsedRate");
                if (usedRate > 50) {
                    heapUsedRateDom.style.color = '#cc0c0c';
                } else {
                    heapUsedRateDom.style.color = '#29da93';
                }
                ;
                document.querySelector("#heapInit").innerHTML = initValue;
                document.querySelector("#heapMax").innerHTML = maxValue;
                document.querySelector("#heapUsed").innerHTML = usedValue;
                heapUsedRateDom.innerHTML = `${usedRate.toFixed(2)}%`;
            });
        }

        function loadNonHeapMemoryInfo() {
            get(concatToken('contextPath/koTime/memories/nonHeap'), function (res) {
                if (res['state']==0) {
                    noticeError("载入memories/nonHeap失败！");
                    return;
                }
                let data = res['content'];
                let initValue = getSize(data['initValue']);
                let maxValue = getSize(data['maxValue']);
                let usedValue = getSize(data['usedValue']);
                let usedRate = data['usedRate'] * 100;
                var nonheapUsedRateDom = document.querySelector("#nonHeapUsedRate");
                if (usedRate > 50) {
                    nonheapUsedRateDom.style.color = '#cc0c0c';
                } else {
                    nonheapUsedRateDom.style.color = '#29da93';
                }
                ;
                document.querySelector("#nonHeapInit").innerHTML = initValue;
                document.querySelector("#nonHeapMax").innerHTML = maxValue;
                document.querySelector("#nonHeapUsed").innerHTML = usedValue;
                if (data['maxValue']==-1) {
                    nonheapUsedRateDom.innerHTML = `-%`;
                }else {
                    nonheapUsedRateDom.innerHTML = `${usedRate.toFixed(2)}%`;
                }
            });
        }

        function loadPhysicalMemoryInfo() {
            get(concatToken('contextPath/koTime/memories/physical'), function (res) {
                if (res['state']==0) {
                    noticeError("载入memories/physical失败！");
                    return;
                }
                let data = res['content'];
                // let initValue = data['initValue'] / 1024 / 1024;
                // let thisUsedValue = data['thisUsedValue'] / 1024 / 1024;
                // let usedValue = data['usedValue'] / 1024 / 1024;

                let initValue = getSize(data['initValue']);
                let thisUsedValue = getSize(data['thisUsedValue']);
                let usedValue = getSize(data['usedValue']);

                let usedRate = data['usedRate'] * 100;
                var physicalUsedRateDom = document.querySelector("#physicalUsedRate");
                if (usedRate > 50) {
                    physicalUsedRateDom.style.color = '#cc0c0c';
                } else {
                    physicalUsedRateDom.style.color = '#29da93';
                }
                ;
                physicalUsedRateDom.innerHTML = `${usedRate.toFixed(2)}%`;
                document.querySelector("#physicalAmount").innerHTML = initValue;
                document.querySelector("#physicalUsed").innerHTML = usedValue;
                document.querySelector("#thisUsed").innerHTML = thisUsedValue;
            });
        }

        function loadEdenSpace() {
            get(concatToken('contextPath/koTime/jvmSpaces/edenSpace'), function (res) {
                if (res['state']==0) {
                    noticeError("载jvmSpaces/edenSpace失败！");
                    return;
                }
                let data = res['content'];
                let initValue = getSize(data['initValue']);
                let maxValue = getSize(data['maxValue']);
                let usedValue = getSize(data['usedValue']);
                let usedRate = data['usedRate'] * 100;
                let edenSpaceUsedRateDom = document.querySelector("#edenSpaceUsedRate");
                if (usedRate > 50) {
                    edenSpaceUsedRateDom.style.color = '#cc0c0c';
                } else {
                    edenSpaceUsedRateDom.style.color = '#29da93';
                }
                ;
                document.querySelector("#edenSpaceInit").innerHTML = initValue;
                document.querySelector("#edenSpaceMax").innerHTML = maxValue;
                document.querySelector("#edenSpaceUsed").innerHTML = usedValue;
                edenSpaceUsedRateDom.innerHTML = `${usedRate.toFixed(2)}%`;
            });
        }

        function loadSurvivorSpace() {
            get(concatToken('contextPath/koTime/jvmSpaces/survivorSpace'), function (res) {
                if (res['state']==0) {
                    noticeError("载jvmSpaces/survivorSpace失败！");
                    return;
                }
                let data = res['content'];
                let initValue = getSize(data['initValue']);
                let maxValue = getSize(data['maxValue']);
                let usedValue = getSize(data['usedValue']);
                let usedRate = data['usedRate'] * 100;
                let survivorSpaceUsedRateDom = document.querySelector("#survivorSpaceUsedRate");
                if (usedRate > 50) {
                    survivorSpaceUsedRateDom.style.color = '#cc0c0c';
                } else {
                    survivorSpaceUsedRateDom.style.color = '#29da93';
                }
                ;
                document.querySelector("#survivorSpaceInit").innerHTML = initValue;
                document.querySelector("#survivorSpaceMax").innerHTML = maxValue;
                document.querySelector("#survivorSpaceUsed").innerHTML = usedValue;
                survivorSpaceUsedRateDom.innerHTML = `${usedRate.toFixed(2)}%`;
            });
        }

        function loadOldGenSpace() {
            get(concatToken('contextPath/koTime/jvmSpaces/oldGen'), function (res) {
                if (res['state']==0) {
                    noticeError("载jvmSpaces/oldGen失败！");
                    return;
                }
                let data = res['content'];
                let initValue = getSize(data['initValue']);
                let maxValue = getSize(data['maxValue']);
                let usedValue = getSize(data['usedValue']);
                let usedRate = data['usedRate'] * 100;
                let oldGenUsedRateDom = document.querySelector("#oldGenUsedRate");
                if (usedRate > 50) {
                    oldGenUsedRateDom.style.color = '#cc0c0c';
                } else {
                    oldGenUsedRateDom.style.color = '#29da93';
                }
                ;
                document.querySelector("#oldGenInit").innerHTML = initValue;
                document.querySelector("#oldGenMax").innerHTML = maxValue;
                document.querySelector("#oldGenUsed").innerHTML = usedValue;
                oldGenUsedRateDom.innerHTML = `${usedRate.toFixed(2)}%`;
            });
        }

        function loadMetaspace() {
            get(concatToken('contextPath/koTime/jvmSpaces/metaspace'), function (res) {
                if (res['state']==0) {
                    noticeError("载jvmSpaces/metaspace失败！");
                    return;
                }
                let data = res['content'];
                let initValue = getSize(data['initValue']);
                let maxValue = getSize(data['maxValue']);
                let usedValue = getSize(data['usedValue']);
                let usedRate = data['usedRate'] * 100;
                let metaspaceUsedRateDom = document.querySelector("#metaspaceUsedRate");
                if (usedRate > 50) {
                    metaspaceUsedRateDom.style.color = '#cc0c0c';
                } else {
                    metaspaceUsedRateDom.style.color = '#29da93';
                }
                ;
                document.querySelector("#metaspaceInit").innerHTML = initValue;
                document.querySelector("#metaspaceMax").innerHTML = maxValue;
                document.querySelector("#metaspaceUsed").innerHTML = usedValue;
                if (data['maxValue']==-1) {
                    metaspaceUsedRateDom.innerHTML = `-%`;
                }else {
                    metaspaceUsedRateDom.innerHTML = `${usedRate.toFixed(2)}%`;
                }
            });
        }

        function loadGcUsage() {
            get(concatToken('contextPath/koTime/gcs/usage'), function (res) {
                if (res['state']==0) {
                    noticeError("载gcs/usage失败！");
                    return;
                }
                let data = res['content'];
                let totalNum = data['totalNum'];
                let fullNum = data['fullNum'];
                let minorNum = data['minorNum'];

                document.querySelector("#gcTotalNum").innerHTML = totalNum;
                document.querySelector("#gcMinorNum").innerHTML = minorNum;
                document.querySelector("#gcFullNum").innerHTML = fullNum;

            });
        }

        function loadThreadUsage() {
            get(concatToken('contextPath/koTime/threads/usage'), function (res) {
                if (res['state']==0) {
                    noticeError("载threads/usage失败！");
                    return;
                }
                let data = res['content'];
                let totalNum = data['totalNum'];
                let runnableNum = data['runnableNum'];
                let deadlockNum = data['deadLockNum'];

                let threadLockNumDom = document.querySelector("#threadLockNum");
                if (deadlockNum > 0) {
                    threadLockNumDom.style.color = '#cc0c0c';
                } else {
                    threadLockNumDom.style.color = '#29da93';
                }

                document.querySelector("#threadTotalNum").innerHTML = totalNum;
                document.querySelector("#threadRunnableNum").innerHTML = runnableNum;
                threadLockNumDom.innerHTML = deadlockNum;

            });
        }

        function loadClassUsage() {
            get(concatToken('contextPath/koTime/classes/usage'), function (res) {
                if (res['state']==0) {
                    noticeError("载classes/usage失败！");
                    return;
                }
                let data = res['content'];
                let totalNum = data['totalClassNum'];
                let currentClassNum = data['currentClassNum'];
                let unloadedClassNum = data['unloadedClassNum'];

                document.querySelector("#classTotalNum").innerHTML = totalNum;
                document.querySelector("#classCurrentNum").innerHTML = currentClassNum;
                document.querySelector("#classDeleteNum").innerHTML = unloadedClassNum;

            });
        }

        const cpuUsageColorMap = {
            'RED': '#cc0c0c',
            'YELLOW': '#f0ad4e',
            'LIGHT_BLUE': '#5bc0de'
        };

        function getCpuUsageColor(usage) {
            if (usage > 50) {
                return cpuUsageColorMap['RED'];
            } else if (usage >= 20 && usage <= 50) {
                return cpuUsageColorMap['YELLOW'];
            } else {
                return cpuUsageColorMap['LIGHT_BLUE'];
            }
        }

        let threadMap = new Map();

        function loadThreadsInfo(queryState) {
            queryState = queryState || '';
            get(concatToken('contextPath/koTime/threads?state=' + queryState), function (res) {
                if (res['state']==0) {
                    noticeError("载入threads失败！");
                    return;
                }
                let data = res['content'];
                let statistics = data['statistics'];
                let all = statistics['all'];
                let RUNNABLE = statistics['RUNNABLE'] || 0;
                let BLOCKED = statistics['BLOCKED'] || 0;
                let WAITING = statistics['WAITING'] || 0;
                let TIMED_WAITING = statistics['TIMED_WAITING'] || 0;

                document.querySelector("#threadNum").innerHTML = all;
                document.querySelector("#runnableNum").innerHTML = RUNNABLE;
                document.querySelector("#blockedNum").innerHTML = BLOCKED;
                document.querySelector("#waitingNum").innerHTML = WAITING;
                document.querySelector("#timedWaitingNum").innerHTML = TIMED_WAITING;

                let element = getDom('threadList');
                let html = '';
                let threads = data['threads'];
                let colors = {
                    'RUNNABLE': '#32d296',
                    'BLOCKED': '#e0ce86',
                    'WAITING': '#eec793',
                    'TIMED_WAITING': '#d99292'
                }
                for (let i = 0; i < threads.length; i++) {
                    let thread = threads[i];
                    let id = thread['id'];
                    let name = thread['name'];
                    let classType = thread['classType'];
                    let state = thread['state'];
                    let stacks = thread['stacks'];
                    let cpuUsage = thread['cpuUsage'];
                    let deadLock = thread['deadLock'];
                    let cpuUsageColor = getCpuUsageColor(cpuUsage);
                    threadMap[id + ''] = stacks;
                    if (deadLock) {
                        html += `<li onclick="showThreadInfo('${id}')" class='common-li'>id=<span style="font-size: 16px;font-weight: 500;">${id}</span>&nbsp; &nbsp;name=${name}&nbsp; &nbsp;class=${classType}&nbsp; &nbsp;<span style="font-size: 10px;background-color: ${cpuUsageColor};" class="uk-label uk-label-success">{{tab.thread.thread-list.cpu-usage}}:${cpuUsage}%</span>&nbsp; &nbsp;<span style='font-size: 10px;background-color: ${colors[state]};' class="uk-label uk-label-success">${state}</span>&nbsp; &nbsp;<span style='font-size: 10px;background-color: #ec2147;' class="uk-label">DEADLOCK</span></li>`;
                    }else {
                        html += `<li onclick="showThreadInfo('${id}')" class='common-li'>id=<span style="font-size: 16px;font-weight: 500;">${id}</span>&nbsp; &nbsp;name=${name}&nbsp; &nbsp;class=${classType}&nbsp; &nbsp;<span style="font-size: 10px;background-color: ${cpuUsageColor};" class="uk-label uk-label-success">{{tab.thread.thread-list.cpu-usage}}:${cpuUsage}%</span>&nbsp; &nbsp;<span style='font-size: 10px;background-color: ${colors[state]};' class="uk-label uk-label-success">${state}</span></li>`;
                    }
                }
                element.innerHTML = html;
            });
        }

        function showThreadInfo(id) {
            let stacks = threadMap[id];
            let html = '';
            for (let i = 0; i < stacks.length; i++) {
                let stack = stacks[i];
                let className = stack['className']
                let methodName = stack['methodName']
                let fileName = stack['fileName']
                let lineNumber = stack['lineNumber']
                html += `<li class='common-li'>${className}.${methodName}&nbsp; &nbsp;<span style='font-size: 10px;background-color: darkslategray;text-transform: unset' class="uk-label uk-label-success">${fileName}：${lineNumber}</span></li>`;

            }
            let threadDetailDom = getDom('thread-detail');
            threadDetailDom.innerHTML = html;
            UIkit.notification.closeAll();
            UIkit.modal(getDom("modal-thread")).show();
        }
        function changeApiSort() {
            loadApis();
        }

        function exportApis() {
            let searchDom = getDom("searchText");
            let searchText = searchDom.value;
            let apiSortName = getDom('apiSortName')
            let apiSortType = getDom('apiSortType')
            let url = concatToken(`contextPath/koTime/interfaces/export?question=${searchText}&orderBy=${apiSortName.value}&sort=${apiSortType.value}`);
            let a = document.createElement("a");
            a.style.display='none';
            a.href = url;
            a.click();
            setTimeout(()=>{a.remove();},3000);
        }

        function dumpHeap() {
            let url = concatToken(`contextPath/koTime/memories/heap/export`);
            let a = document.createElement("a");
            a.style.display='none';
            a.href = url;
            a.click();
            setTimeout(()=>{a.remove();},3000);
        }

        $(document).ready(function () {
            refreshData();
        });


    </script>
</head>
<!--endreplace-->
<body style="background-color: #f2f3f2">


<nav class="uk-navbar-container" style="background-color: #404b67;height: 80px" uk-navbar>
    <div class="uk-navbar-center">
        <div class="uk-grid-small" uk-grid>
            <div title="{{kotime-refresh}}" style="margin-top: 20px;font-size: 24px;color: white;cursor: pointer"
                 class="uk-width-expand" onclick="refreshData()">{{kotime-title}}
            </div>
        </div>
    </div>
</nav>

<ul class="uk-flex-center" uk-tab style="background-color: #404b67;margin-top: 0px;">
    <li id="zl" class="uk-active"><a href="#" style="color: #edeef1;font-size: 14px;text-transform: unset">{{tab.summary}}</a></li>
    <li id="jklb"><a href="#" style="color: #edeef1;font-size: 14px;text-transform: unset">{{tab.interface}}</a></li>
    <li><a href="#" style="color: #edeef1;font-size: 14px;text-transform: unset">{{tab.exception}}</a></li>
    <li><a href="#" style="color: #edeef1;font-size: 14px;text-transform: unset">{{tab.thread}}</a></li>
    <li><a href="#" style="color: #edeef1;font-size: 14px;text-transform: unset">{{tab.hotupdate}}</a></li>
    <li><a href="#" style="color: #edeef1;font-size: 14px;text-transform: unset">{{tab.configuration}}</a></li>
    <li><a href="#" style="color: #edeef1;font-size: 14px;text-transform: unset">{{tab.support}}</a>
        <span title="{{tab.support.version-tip}}" style="position: absolute;top:-10px;left: 90%;border-radius: 5px;text-transform: unset"
                                                                             class="uk-label" id="version-notice"
                                                                             onclick="window.location.href='http://www.kotime.cn/docs/kaiyuan#/v220/introduce'"></span>
    </li>
</ul>

<ul class="uk-switcher uk-margin">
    <li style="margin-left: 28%;margin-right: 28%;margin-top: -10px">
        <ul class="uk-flex-left" uk-tab>
            <li class="uk-active"><a style="text-transform: unset" href="#">{{tab.summary.interface-metric}}</a></li>
        </ul>
        <div style="margin-top: 10px;" class="uk-grid-small uk-child-width-expand@s uk-text-center" uk-grid>
            <div>
                <div id="systemNum-div" class="uk-card uk-card-default uk-card-body uk-label-success metric-card">
                    <span class="metric-card-summary-n">{{tab.summary.interface-metric.total-num}}：</span><span class="metric-card-summary-v" id="systemTotalNum">0</span>
                    <hr style="margin-top: 7px">
                    <ul class="uk-list metric-card-item">
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.interface-metric.delay-num}}：</span><span class="metric-card-item-v" id="systemDelayNum">0</span></li>
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.interface-metric.normal-num}}：</span><span class="metric-card-item-v" id="systemNormalNum">0</span></li>
                    </ul>
                </div>
            </div>
            <div>
                <div id="systemRunTime-div" class="uk-card uk-card-default uk-card-body uk-label-success metric-card">
                    <span class="metric-card-summary-n">{{tab.summary.response-metric.avg-num}}：</span><span class="metric-card-summary-v" id="systemAvgRunTime">0</span>
                    <hr style="margin-top: 7px">
                    <ul class="uk-list metric-card-item">
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.response-metric.max-num}}：</span><span class="metric-card-item-v" id="systemMaxRunTime">0</span></li>
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.response-metric.min-num}}：</span><span class="metric-card-item-v" id="systemMinRunTime">0</span></li>
                    </ul>
                </div>
            </div>
            <div>
                <div id="systemCallNum-div" class="uk-card uk-card-default uk-card-body uk-label-success metric-card">
                    <span class="metric-card-summary-n">{{tab.summary.interface-metric.avg-call-num}}：</span><span class="metric-card-summary-v" id="systemAvgCallNum">0</span>
                    <hr style="margin-top: 7px">
                    <ul class="uk-list metric-card-item">
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.interface-metric.max-call-num}}：</span><span class="metric-card-item-v" id="systemMaxCallNum">0</span></li>
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.interface-metric.min-call-num}}：</span><span class="metric-card-item-v" id="systemMinCallNum">0</span></li>
                    </ul>
                </div>
            </div>
        </div>

        <ul style="margin-top: 10px;" class="uk-flex-left" uk-tab>
            <li class="uk-active"><a style="text-transform: unset" href="#">{{tab.summary.memory-metric}}</a></li>
        </ul>
        <div style="margin-top: 10px;" class="uk-grid-small uk-child-width-expand@s uk-text-center" uk-grid>
            <div>
                <div id="physicalMemory-div" class="uk-card uk-card-default uk-card-body uk-label-success metric-card">
                    <span class="metric-card-summary-n">{{tab.summary.sysusage-metric.physical-memory}}：</span><span class="metric-card-summary-v" id="physicalUsedRate">0</span>
                    <hr style="margin-top: 7px">
                    <ul class="uk-list metric-card-item">
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.physical-memory.total}}：</span><span class="metric-card-item-v" id="physicalAmount">0</span></li>
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.physical-memory.used}}：</span><span class="metric-card-item-v" id="physicalUsed">0</span></li>
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.physical-memory.current-used}}：</span><span class="metric-card-item-v" id="thisUsed">0</span></li>
                    </ul>
                </div>
            </div>
            <div>
                <div id="heapMemory-div"  class="uk-card uk-card-default uk-card-body uk-label-success metric-card">
                    <span onclick="dumpHeap();" style="text-transform: unset;background-color: #404b67;position: absolute;cursor: pointer" title="dump" class="uk-card-badge">&gt;</span>
                    <span class="metric-card-summary-n">{{tab.summary.sysusage-metric.heap-memory}}：</span><span class="metric-card-summary-v" id="heapUsedRate">0</span>
                    <hr style="margin-top: 7px">
                    <ul class="uk-list metric-card-item">
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.heap-memory.init}}：</span><span class="metric-card-item-v" id="heapInit">0</span></li>
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.heap-memory.max}}：</span><span class="metric-card-item-v" id="heapMax">0</span></li>
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.heap-memory.used}}：</span><span class="metric-card-item-v" id="heapUsed">0</span></li>
                    </ul>
                </div>
            </div>
            <div>
                <div id="nonHeapMemory-div"  class="uk-card uk-card-default uk-card-body uk-label-success metric-card">
                    <span class="metric-card-summary-n">{{tab.summary.sysusage-metric.non-heap-memory}}：</span><span class="metric-card-summary-v" id="nonHeapUsedRate">0</span>
                    <hr style="margin-top: 7px">
                    <ul class="uk-list metric-card-item">
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.heap-memory.init}}：</span><span class="metric-card-item-v" id="nonHeapInit">0</span></li>
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.heap-memory.max}}：</span><span class="metric-card-item-v" id="nonHeapMax">0</span></li>
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.heap-memory.used}}：</span><span class="metric-card-item-v" id="nonHeapUsed">0</span></li>
                    </ul>
                </div>
            </div>
        </div>

        <ul style="margin-top: 10px;" class="uk-flex-left" uk-tab>
            <li class="uk-active"><a style="text-transform: unset" href="#">{{tab.summary.jvm-metric}}</a></li>
        </ul>
        <div style="margin-top: 10px;" class="uk-grid-small uk-child-width-expand@s uk-text-center" uk-grid>
            <div>
                <div id="EdenSpace-div" class="uk-card uk-card-default uk-card-body uk-label-success metric-card">
                    <span class="metric-card-summary-n">{{tab.summary.sysusage-metric.eden-space}}：</span><span class="metric-card-summary-v" id="edenSpaceUsedRate">0</span>
                    <hr style="margin-top: 7px">
                    <ul class="uk-list metric-card-item">
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.heap-memory.init}}：</span><span class="metric-card-item-v" id="edenSpaceInit">0</span></li>
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.heap-memory.max}}： </span><span class="metric-card-item-v" id="edenSpaceMax">0</span></li>
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.heap-memory.used}}：</span><span class="metric-card-item-v" id="edenSpaceUsed">0</span></li>
                    </ul>
                </div>
            </div>
            <div>
                <div id="SurvivorSpace-div"  class="uk-card uk-card-default uk-card-body uk-label-success metric-card">
                    <span class="metric-card-summary-n">{{tab.summary.sysusage-metric.survivor-space}}：</span><span class="metric-card-summary-v" id="survivorSpaceUsedRate">0</span>
                    <hr style="margin-top: 7px">
                    <ul class="uk-list metric-card-item">
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.heap-memory.init}}：</span><span class="metric-card-item-v" id="survivorSpaceInit">0</span></li>
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.heap-memory.max}}： </span><span class="metric-card-item-v" id="survivorSpaceMax">0</span></li>
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.heap-memory.used}}：</span><span class="metric-card-item-v" id="survivorSpaceUsed">0</span></li>
                    </ul>
                </div>
            </div>
            <div>
                <div id="OldGen-div"  class="uk-card uk-card-default uk-card-body uk-label-success metric-card">
                    <span class="metric-card-summary-n">{{tab.summary.sysusage-metric.old-gen}}：</span><span class="metric-card-summary-v" id="oldGenUsedRate">0</span>
                    <hr style="margin-top: 7px">
                    <ul class="uk-list metric-card-item">
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.heap-memory.init}}：</span><span class="metric-card-item-v" id="oldGenInit">0</span></li>
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.heap-memory.max}}： </span><span class="metric-card-item-v" id="oldGenMax">0</span></li>
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.heap-memory.used}}：</span><span class="metric-card-item-v" id="oldGenUsed">0</span></li>
                    </ul>
                </div>
            </div>
            <div>
                <div id="Metaspace-div"  class="uk-card uk-card-default uk-card-body uk-label-success metric-card">
                    <span class="metric-card-summary-n">{{tab.summary.sysusage-metric.meta-space}}：</span><span class="metric-card-summary-v" id="metaspaceUsedRate">0</span>
                    <hr style="margin-top: 7px">
                    <ul class="uk-list metric-card-item">
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.heap-memory.init}}：</span><span class="metric-card-item-v" id="metaspaceInit">0</span></li>
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.heap-memory.max}}： </span><span class="metric-card-item-v" id="metaspaceMax">0</span></li>
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.heap-memory.used}}：</span><span class="metric-card-item-v" id="metaspaceUsed">0</span></li>
                    </ul>
                </div>
            </div>
        </div>
        <ul class="uk-flex-left" uk-tab>
            <li class="uk-active"><a style="text-transform: unset" href="#">{{tab.summary.other-metric}}</a></li>
        </ul>
        <div style="margin-top: 10px;" class="uk-grid-small uk-child-width-expand@s uk-text-center" uk-grid>
            <div>
                <div id="cpuInfo-div" class="uk-card uk-card-default uk-card-body uk-label-success metric-card">
                    <span id="cpuLogicalAmount" class="metric-card-summary-n">{{tab.summary.sysusage-metric.cpu-usage}}：</span><span class="metric-card-summary-v" id="systemLoad">0</span>
                    <hr style="margin-top: 7px">
                    <ul class="uk-list metric-card-item">
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.cpu-usage.user-usage}}：</span><span class="metric-card-item-v" id="cpuUserRate">0</span></li>
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.cpu-usage.sys-usage}}：</span><span class="metric-card-item-v" id="cpuSysRate">0</span></li>
                    </ul>
                </div>
            </div>
            <div>
                <div id="gc-div" class="uk-card uk-card-default uk-card-body uk-label-success metric-card">
                    <span class="metric-card-summary-n">{{tab.summary.sysusage-metric.gc-num}}：</span><span class="metric-card-summary-v" id="gcTotalNum">0</span>
                    <hr style="margin-top: 7px">
                    <ul class="uk-list metric-card-item">
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.gc-num.minor}}：</span><span class="metric-card-item-v" id="gcMinorNum">0</span></li>
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.gc-num.full}}：</span><span class="metric-card-item-v" id="gcFullNum">0</span></li>
                    </ul>
                </div>
            </div>
            <div>
                <div id="thread-div" class="uk-card uk-card-default uk-card-body uk-label-success metric-card">
                    <span class="metric-card-summary-n">{{tab.summary.sysusage-metric.thread-num}}：</span><span class="metric-card-summary-v" id="threadTotalNum">0</span>
                    <hr style="margin-top: 7px">
                    <ul class="uk-list metric-card-item">
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.thread-num.runnable}}：</span><span class="metric-card-item-v" id="threadRunnableNum">0</span></li>
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.thread-num.deadlock}}：</span><span class="metric-card-item-v" id="threadLockNum">0</span></li>
                    </ul>
                </div>
            </div>
            <div>
                <div id="class-div" class="uk-card uk-card-default uk-card-body uk-label-success metric-card">
                    <span class="metric-card-summary-n">{{tab.summary.sysusage-metric.loaded-class-num}}：</span><span class="metric-card-summary-v" id="classTotalNum">0</span>
                    <hr style="margin-top: 7px">
                    <ul class="uk-list metric-card-item">
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.loaded-class-num.current}}：</span><span class="metric-card-item-v" id="classCurrentNum">0</span></li>
                        <li><div class="metric-card-item-point"></div><span class="metric-card-item-n">{{tab.summary.sysusage-metric.loaded-class-num.unloaded}}：</span><span class="metric-card-item-v" id="classDeleteNum">0</span></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="uk-alert-success" uk-alert>
            <a class="uk-alert-close" uk-close></a>
            <p id="apiTip">{{tab.summary.bottom-normal-tip}}</p>
        </div>
    </li>
    <li style="margin-left: 20%;margin-right: 20%;margin-top: -10px">
        <div style="margin-left: 10%;margin-right: 10%;" class="uk-grid-small uk-flex-center uk-text-center" uk-grid>
            <div class="uk-width-3-5@s">
                <div style="left: 10%;width: 400px;" class="uk-search uk-search-default">
                    <span uk-search-icon></span>
                    <input list="condidates" id="searchText"
                           style="border-top: none;border-right: none;border-left: none;border-bottom: 1px solid lightgreen;color:#213121"
                           class="uk-search-input" type="search" placeholder="{{tab.interface.search-tip}}"
                           oninput="searchTip(event);" onkeydown="searchApis(event);">
                    <datalist id="condidates" onkeydown="searchApis(event);">
                    </datalist>
                </div>
            </div>
            <div class="uk-width-1-5@s">
                <div style="display: flex;">
                    <input style="width: 60px;border-top: none;border-right: none;border-left: none;background-color: inherit" class="uk-input"  type="text" placeholder="{{tab.interface.interface-list.sort-tip}}" value="{{tab.interface.interface-list.sort-tip}}" disabled>
                    <select id="apiSortName" onchange="changeApiSort()"  style="cursor: pointer;width: 100px;border-top: none;border-right: none;border-left: none;border-bottom: 1px solid lightgreen;color:#213121;background-color: inherit" class="uk-select">
                        <option value="avgRunTime" selected>{{tab.interface.interface-list.avg-tip}}</option>
                        <option value="callNum">{{tab.interface.interface-list.call-num-tip}}</option>
                    </select>
                </div>
            </div>
            <div class="uk-width-1-5@s">
                <div style="display: flex;width: 100px">
                    <select id="apiSortType" onchange="changeApiSort()"  style="cursor: pointer;width: 70px;border-top: none;border-right: none;border-left: none;border-bottom: 1px solid lightgreen;color:#213121;background-color: inherit" class="uk-select">
                        <option value="desc" selected>{{tab.interface.interface-list.sort-desc-tip}}</option>
                        <option value="asc">{{tab.interface.interface-list.sort-asc-tip}}</option>
                    </select>
                    <button onclick="exportApis()" style="width: 100px;border: none;color: #1f2c59;font-weight: bolder" title="导出csv" class="uk-button uk-button-default">=></button>
                </div>
            </div>
        </div>
        <ul id="apiList" style="background-color: rgba(245,242,242,0.96);padding: 10px;overflow-y: auto;max-height: 70%;margin-top: 10px" class="uk-list uk-list-divider">
            <li>method 1 1&nbsp<span class="uk-label uk-label-success">0</span></li>
        </ul>
    </li>
    <li style="margin-left: 20%;margin-right: 20%;margin-top: -10px">
        <ul id="exceptionList"
            style="background-color: rgba(245,242,242,0.96);padding: 10px;overflow-y: auto;max-height: 73%"
            class="uk-list uk-list-divider">
            <li>exception 1 1&nbsp<span class="uk-label uk-label-danger">未开启</span></li>
        </ul>
    </li>
    <li style="margin-left: 30%;margin-right: 30%;margin-top: -10px">
        <ul class="uk-flex-left" uk-tab>
            <li class="uk-active"><a style="text-transform: unset" href="#">{{tab.thread.thread-metric}}</a></li>
        </ul>
        <div style="margin-top: 20px;" class="uk-grid-small uk-child-width-expand@s uk-text-center" uk-grid>
            <div>
                <div onclick="loadThreadsInfo('')" id="threadNum-div"
                     style="cursor:pointer;border-radius: 10px;background-color: #fefffe;padding: 20px"
                     class="uk-card uk-card-default uk-card-body uk-label-success">
                    <span style="font-size: 10px;color: #3b3f4f">ALL</span><br>
                    <span style="font-size: 30px;color: #020718;font-weight: bold" id="threadNum">0</span>
                </div>
            </div>
            <div>
                <div onclick="loadThreadsInfo('RUNNABLE')" id="runnableNum-div"
                     style="cursor:pointer;border-radius: 10px;background-color: #fefffe;padding: 20px"
                     class="uk-card uk-card-default uk-card-body uk-label-success">
                    <span style="font-size: 10px;color: #3b3f4f">RUNNABLE</span>
                    <br>
                    <span style="font-size: 30px;color: #29da93;font-weight: bold" id="runnableNum">0</span>
                </div>
            </div>
            <div>
                <div onclick="loadThreadsInfo('BLOCKED')" id="blockedNum-div"
                     style="cursor:pointer;border-radius: 10px;background-color: #fefffe;padding: 20px"
                     class="uk-card uk-card-default uk-card-body uk-label-success">
                    <span style="font-size: 10px;color: #3b3f4f">BLOCKED</span>
                    <br>
                    <span style="font-size: 30px;color: #cc0c0c;font-weight: bold" id="blockedNum">0</span></div>
            </div>
            <div>
                <div onclick="loadThreadsInfo('WAITING')" id="waitingNum-div"
                     style="cursor:pointer;border-radius: 10px;background-color: #fefffe;padding: 20px"
                     class="uk-card uk-card-default uk-card-body uk-label-success">
                    <span style="font-size: 10px;color: #3b3f4f">WAITING</span>
                    <br>
                    <span style="font-size: 30px;color: #ad7070;font-weight: bold" id="waitingNum">0</span></div>
            </div>
            <div>
                <div onclick="loadThreadsInfo('TIMED_WAITING')" id="timedWaitingNum-div"
                     style="cursor:pointer;border-radius: 10px;background-color: #fefffe;padding: 20px"
                     class="uk-card uk-card-default uk-card-body uk-label-success">
                    <span style="font-size: 10px;color: #3b3f4f">TIMED_WAITING</span>
                    <br>
                    <span style="font-size: 30px;color: #ad7070;font-weight: bold" id="timedWaitingNum">0</span></div>
            </div>
        </div>
        <ul class="uk-flex-left" uk-tab>
            <li class="uk-active"><a style="text-transform: unset" href="#">{{tab.thread.thread-list}}</a></li>
        </ul>
        <ul id="threadList"
            style="background-color: rgba(245,242,242,0.96);padding: 10px;overflow-y: auto;max-height: 65%"
            class="uk-list uk-list-divider">
            <li>thread 1 1&nbsp<span class="uk-label uk-label-success">0</span></li>
        </ul>
    </li>
    <li style="margin-left: 35%;margin-right: 35%;margin-top: -10px">
        <div class="uk-card uk-card-default uk-card-body" style="border-radius: 5px">
            <div id="classForm">
                <div uk-form-custom="target: true" class="uk-form-controls">
                    <input id="classFile" name="classFile" type="file">
                    <input id="form-file" style="width: 500px;border-radius: 5px" class="uk-input" type="text"
                           placeholder="{{tab.hotupdate.class-file-input-tip}}">
                </div>
                <br>
                <br>
                <input id="className" name="className" style="width: 500px;border-radius: 5px" class="uk-input"
                       type="text" placeholder="{{tab.hotupdate.class-name-input-tip}}">
                <br>
                <br>
                <button type="button" onclick="updateClass();"
                        style="width: 500px;background-color: #19985d;border-radius: 5px"
                        class="uk-button uk-button-primary uk-width-1-1 uk-margin-small-bottom">{{kotime-confirm}}
                </button>
            </div>
        </div>
    </li>
    <li style="margin-left: 30%;margin-right: 30%;margin-top: -10px">
        <ul class="uk-flex-left" uk-tab>
            <li class="uk-active"><a href="#" style="text-transform: unset">{{tab.configuration.kotime-config}}</a></li>
            <li class=""><a href="#" style="text-transform: unset">{{tab.configuration.dynamic-config}}</a></li>
        </ul>
        <ul class="uk-switcher uk-margin">
            <li>
                <div style="margin-top: 20px;"
                     class="uk-child-width-expand@s uk-text-left uk-card uk-card-default uk-card-body"
                     style="border-radius: 5px">
                    <div>
                        <label>{{tab.configuration.kotime-config.enable-kotime-tip}}：</label> <input id='kotimeEnable' type="checkbox" checked>
                        <br>
                        <label>{{tab.configuration.kotime-config.enable-exception-tip}}：</label> <input id='exceptionEnable' type="checkbox">
                        <br>
                        <label>{{tab.configuration.kotime-config.enable-console-tip}}：</label> <input id='logEnable' type="checkbox">
                        <br>
                        <label>{{tab.configuration.kotime-config.enable-email-tip}}：</label> <input id='mailEnable' type="checkbox">
                        <br>
                        <label>{{tab.configuration.kotime-config.enable-abbreviation-tip}}：</label> <input id='abbreviationEnable' type="checkbox">
                        <br>
                        <label>{{tab.configuration.kotime-config.select-language-tip}}：</label>
                        <select id="languageSwitch">
                            <option value="chinese">{{tab.configuration.kotime-config.select-language-chinese}}</option>
                            <option value="english">{{tab.configuration.kotime-config.select-language-english}}</option>
                        </select>
                        <br>
                        <label>{{tab.configuration.kotime-config.threshold-tip}}：</label> <input id='timeThreshold' type="input">
                        <button style="background-color: #177ce1;border: 1px solid #177ce1;cursor: pointer;color: white"
                                id="timeThresholdYes">{{tab.configuration.kotime-config.threshold-confirm}}
                        </button>
                        <br>
                        <label>{{tab.configuration.kotime-config.clear-data-tip}}：</label>
                        <button style="background-color: #177ce1;border: 1px solid #177ce1;cursor: pointer;color: white"
                                id="clearDataYes">{{tab.configuration.kotime-config.clear-data-confirm}}
                        </button>
                        <br>
                        <br>
                        <div class="uk-alert-success" uk-alert>
                            <a class="uk-alert-close" uk-close></a>
                            <p>{{tab.configuration.bottom-tip}}</p>
                        </div>
                    </div>
                </div>
            </li>
            <li>
                <div class="uk-card uk-card-default uk-card-body" style="border-radius: 5px">
                    <textarea id="dynamicText" class="uk-textarea" placeholder="" wrap="off"
                              style="overflow-y: auto;height: 65%;resize: none;overflow-x: auto"></textarea>
                    <br>
                    <br>
                    <button type="button" onclick="updateDynamicProperties();"
                            style="width: 100%;background-color: #19985d;border-radius: 5px;text-transform: unset"
                            class="uk-button uk-button-primary uk-width-1-1 uk-margin-small-bottom">{{tab.configuration.dynamic-config.confirm-name}}
                    </button>
                </div>
            </li>
        </ul>

    </li>
    <li style="margin-left: 30%;margin-right: 30%;margin-top: -10px">
        <script src='https://gitee.com/huoyo/ko-time/widget_preview' async defer></script>
        <div id="osc-gitee-widget-tag"></div>
        <style>
            .osc_pro_color {
                color: #ffffff !important;
            }

            .osc_panel_color {
                background-color: #1e252b !important;
            }

            .osc_background_color {
                background-color: #323d47 !important;
            }

            .osc_border_color {
                border-color: #455059 !important;
            }

            .osc_desc_color {
                color: #d7deea !important;
            }

            .osc_link_color * {
                color: #99a0ae !important;
            }
        </style>
        <br>
        <div class="uk-alert-success" uk-alert>
            <a class="uk-alert-close" uk-close></a>
            <a href="http://www.kotime.cn/#doc">{{tab.support.support-tip}}</a><br>
            <a href="http://www.kotime.cn/#products">{{tab.support.pro-tip}}</a><br>
            <a href="http://www.kotime.cn/person">{{tab.support.plugin-tip}}</a>
        </div>
    </li>
</ul>

<div id="modal-thread" uk-modal>
    <div class="uk-modal-dialog" style="width: 75%">
        <button class="uk-modal-close-default" type="button" uk-close></button>
        <div class="uk-modal-body uk-margin-auto-vertical" uk-overflow-auto>
            <ul id="thread-detail"
                style="background-color: rgba(245,242,242,0.96);padding: 10px;overflow-y: auto;max-height: 70%"
                class="uk-list uk-list-divider">
            </ul>
        </div>
        <div class="uk-modal-footer uk-text-right">
            <button class="uk-button uk-button-primary  uk-modal-close" type="button">{{kotime-confirm}}</button>
        </div>

    </div>
</div>

<div id="modal-exception" uk-modal>
    <div class="uk-modal-dialog">
        <button class="uk-modal-close-default" type="button" uk-close></button>
        <div id="exception-detail" class="uk-modal-body uk-margin-auto-vertical" uk-overflow-auto>

        </div>
        <div class="uk-modal-footer uk-text-right">
            <button class="uk-button uk-button-primary  uk-modal-close" type="button">{{kotime-confirm}}</button>
        </div>

    </div>
</div>

<div id="modal-method" class="uk-modal-full" uk-modal>
    <div class="uk-modal-dialog">
        <button class="uk-modal-close-full uk-close-large" style="color: red" type="button" uk-close></button>
        <div class="uk-grid-collapse uk-child-width-1-1@s uk-flex-middle" uk-grid>
            <div uk-height-viewport>
                <div id="layerDemo" width="1200px" height="900px">
                </div>
            </div>
        </div>
    </div>
</div>

<div id="modal-login" class="uk-modal-full" uk-modal>

    <div class="uk-modal-dialog" style="background-color: rgb(242, 243, 242)">
        <div class="uk-grid-collapse uk-child-width-1-1@s uk-flex-middle" uk-grid>
            <div uk-height-viewport>

                <div class="uk-text-center" uk-grid>
                    <div class="uk-width-1-3@m">
                    </div>
                    <div class="uk-width-1-3@m" style="margin-top: 100px;">
                        <form class="uk-card uk-card-default uk-card-body" style="border-radius: 5px">
                            <div class="uk-margin">
                                <div class="uk-inline">
                                    <div style="font-size: 35px;" class="uk-width-expand">{{kotime-title}}</div>
                                </div>
                            </div>
                            <br>
                            <div class="uk-margin">
                                <div class="uk-inline">
                                    <span class="uk-form-icon" uk-icon="icon: user"></span>
                                    <input id="userName" class="uk-input" type="text">
                                </div>
                            </div>
                            <div class="uk-margin">
                                <div class="uk-inline">
                                    <span class="uk-form-icon uk-form-icon-flip" uk-icon="icon: lock"></span>
                                    <input id="userPassword" type="password" class="uk-input">
                                </div>
                            </div>
                            <div class="uk-margin">
                                <div class="uk-inline">
                                    <a class="uk-button uk-button-default uk-label-success" style="border-radius: 5px"
                                       onclick="login();">{{kotime-confirm}}</a>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="uk-width-1-3@m">
                    </div>
                </div>

            </div>

        </div>
    </div>
</div>


<!--<div class="uk-margin-medium-bottom" style="position:absolute;top:95%;left:45%;text-align:center;">-->
<!--    <ul class="uk-flex-center" uk-tab>-->
<!--        <li class=""><a style="font-size: 7px;text-transform:capitalize" href="#">@2021 Huoyo</a></li>-->
<!--    </ul>-->
<!--</div>-->

</body>
